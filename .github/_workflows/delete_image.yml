name: Branch Deleted
on: delete
jobs:
  delete:
    if: github.event.ref_type == 'branch'
    runs-on: ubuntu-latest
    steps:
      - name: Clean up
        run: |
          registry='https://registry-1.docker.io'
          name='my-image'
          curl -v -sSL -X DELETE "http://${registry}/v2/${name}/manifests/$(
              curl -sSL -I \
                  -H "Accept: application/vnd.docker.distribution.manifest.v2+json" \
                  "http://${registry}/v2/${name}/manifests/$(
                      curl -sSL "http://${registry}/v2/${name}/tags/list" | jq -r '.tags[0]'
                  )" \
              | awk '$1 == "Docker-Content-Digest:" { print $2 }' \
              | tr -d $'\r' \
          )"
